<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- PRELOAD FILES IN ONE STACK -->
	<!-- <script src="./hive-config.json" type="json"></script> -->
	<script src="./utils.mjs" type="module"></script>
	<script src="./pre-game/connection-loader.mjs" type="module"></script>
	<script src="./hive-p2p/libs/xxhash32.mjs" type="module"></script>
	<script src="./visualizer.mjs" type="module"></script>
	<script src="./rendering/NetworkRenderer.mjs" type="module"></script>
	<script src="./rendering/renderer-options.mjs" type="module"></script>
	<script src="./rendering/renderer-stores.mjs" type="module"></script>
	<script src="./components/UI-components.mjs" type="module"></script>
	<script src="./game-logics/consensus.mjs" type="module"></script>
	<script src="./game-logics/upgrades.mjs" type="module"></script>
	<script src="./game-logics/player.mjs" type="module"></script>
	<script src="./game-logics/turn-system.mjs" type="module"></script>
	<script src="./game-logics/resources.mjs" type="module"></script>
	<script src="./game-logics/game.mjs" type="module"></script>
	<script src="./hive-p2p/dist/browser/hive-p2p.min.js" type="module"></script>
	<!-- END PRELOAD -->

	<title>Mycelium</title>
    <link rel="stylesheet" href="style.css">
	<script src="./hive-p2p/libs/three-4.5.min.js"></script>
	<script type="module" src="./main.mjs"></script>
</head>
<body>
	<div class="UI-wrapper">
		<div class="dev-info">
			<div>DEV INFO  |</div>
			<div>¬∞¬∞¬∞¬∞¬∞¬∞¬∞¬∞¬∞¬∞</div>
			<button id="modeSwitchBtn">2D</button>
			<div>FPS: <span id="fpsCount">0</span></div>
			<div>Nodes: <span id="nodeCount">0</span></div>
			<div>Connecting: <span id="connectingCount">0</span></div>
			<div>Neighbors: <span id="neighborCount">0</span></div>
			<div>Publics: <span id="publicNeighborCount">0</span></div>
			<div>Connections: <span id="connectionsCount">0</span></div>
			<div>Lines: <span id="linesCount">0</span></div>
		</div>

		<!-- Dynamic Inventory Display -->
		<div class="inventories-wrapper">
			<div class="resources-bar">
				<div class="resource-bar-title"><span class="me">Me</span><span class="my-inventory">My inventory</span></div>
			</div>
			<!-- Dynamic OtherNode Inventory Display for Spectators -->
			<div class="resources-bar spectator hidden">
				<div class="resource-bar-title">Jacques</div>
			</div>
		</div>

		<div class="upgrade-offers-wrapper" id ="upgrade-offers-wrapper">
			<div class="upgrade-offer trade-hub" id="upgrade-offer-1">
				<div class="tooltip">Connection +1</div>
			</div>
			<div class="upgrade-offer producer" id="upgrade-offer-2">
				<div class="tooltip">Production +40%</div>
			</div>
			<div class="upgrade-offer energy-drop" id="upgrade-offer-3">
				<div class="tooltip">Recover max energy</div>
			</div>
		</div>
	
		<div id="energy-bar-wrapper" class="hoverable-tooltip">
			<div class="resource-icon energy"></div>
			<div class="tooltip" id="energy-tooltip">Your energy is precious, your die if it reaches zero.</div>
			<div class="energy-bar">
				<div class="energy-fill" id="energy-fill"></div>
				<div class="energy-text" id="energy-text"></div>
			</div>
		</div>

		<div class="inputs-wrapper">
			<input type="range" id="energyStorageFactor" min="1" max="5" step="0.1" value="2" title="Energy Storage Factor">
		</div>

		<div class="player-info">
			<div class="player-name"><span id="player-name">PlayerName</span></div>
			<div class="player-id hoverable-tooltip">
				<div class="tooltip">My player/node identifier</div>
				<span id="player-id">...</span>
			</div>
			<div class="player-stats-wrapper">
				<div class="player-stat hoverable-tooltip" id="lifetimeCountWrapper">
					<div class="tooltip">Lifetime</div>
					<img src="./assets/lifetime.png" alt="Lifetime">
					<span id="lifetimeCount">0</span>
				</div>

				<div class="player-stat hoverable-tooltip" id="connectionCountWrapper">
					<div class="tooltip">Connection Status</div>
					<img src="./assets/connections.png" alt="Connection Capacity" style="transform: scale(.9);">
					<span id="connectionCount">0</span>/<span id="connectionMax">0</span>
					<div id="connection-offer-notification">!</div>
				</div>
			</div>
		</div>

		<div class="console">
			<div class="console-header">
				<span class="console-title">‚ö° MYCELIUM NETWORK</span>
			</div>
			<div class="console-body" id="console-log"></div>
		</div>

		<div id="dead-nodes-wrapper">
			<div class="dead-node-notification"> <!-- TEMPLATE -->
				<div class="tooltip">
					<div class="dead-node-tooltip-id">NodeID</div>
					<div class="resource">
						<div class="resource-icon chips"></div>
						<span class="resource-value" data-resource-name="chips">0</span>
					</div>
					<div class="resource">
						<div class="resource-icon datas"></div>
						<span class="resource-value" data-resource-name="datas">0</span>
					</div>
					<div class="resource">
						<div class="resource-icon models"></div>
						<span class="resource-value" data-resource-name="models">0</span>
					</div>
					<div class="resource">
						<div class="resource-icon engineers"></div>
						<span class="resource-value" data-resource-name="engineers">0</span>
					</div>
				</div>
			</div>
		</div>
	
		<div id="node-tooltip"></div>
		<div id="sub-node-info">
			<div class="productions-wrapper"></div>
			<div><span class="player-name">PlayerName</span></div>
			<div id="my-sub-node-marker">
				<div class="arrow-up">^</div>
				<div>Me</div>
			</div>
		</div>
		<div id="node-card">
			<div class="top-left-corner-decoration"></div>
			<div class="close-btn" id="node-card-close-btn">x</div>
			<div><span id="node-card-name">PlayerName</span></div>
			<div><span id="node-card-id">Node ID</span></div>

			<div id="node-card-offer-viewer">
				<div class="close-btn" id="node-card-offer-viewer-close-btn">x</div>
				<div class="resource offered">
					<div class="tooltip">Energy</div>
					<div class="resource-icon energy"></div>
					<span class="resource-value" contenteditable="true">0</span>
				</div>
				<div class="arrow">-></div>
				<div class="resource requested">
					<div class="tooltip">Chips</div>
					<div class="resource-icon chips" id="requested-resource-icon"></div>
					<span class="resource-value" contenteditable="true">0</span>
				</div>
				<div class="btns-wrapper">
					<button id="node-card-cancel-offer-btn" disabled>Cancel Offer</button>
					<button id="node-card-confirm-offer-btn">Send Offer</button>
				</div>
			</div>
			
			<div class="node-actions">
				<button id="node-card-chat-btn">Open chat</button>
				<button id="node-card-connect-btn" disabled>
					<span id="node-card-connect-btn-text">Offer connection</span>
					<div id="node-card-connect-btn-cost">
						<div class="resource-icon energy"></div>
						<span id="node-card-connect-btn-cost-value">10</span>
					</div>
				</button>
				<button id="node-card-trade-offer-btn" disabled>Offer trade</button>
				<button id="node-card-remote-offer-btn" disabled>View remote offer</button>
			</div>
		</div>
	
		<div class="buildings-wrapper">
			<div id="trade-hub-icon" class="building-icon hoverable-tooltip">
				<div class="building-upgradePoints" id="trade-hub-upgrade-points">0</div>
				<div class="tooltip">TradeHub: Networking building</div>
				<img src="./assets/buildings/trade-hub.png" alt="TradeHub">
			</div>
			<div id="reactor-icon" class="building-icon hoverable-tooltip">
				<div class="building-upgradePoints" id="reactor-upgrade-points">0</div>
				<div class="tooltip">Reactor: Produces energy over time</div>
				<img src="./assets/buildings/reactor.png" alt="Reactor">
			</div>
			<div id="fabricator-icon" class="building-icon hoverable-tooltip">
				<div class="building-upgradePoints" id="fabricator-upgrade-points">0</div>
				<div class="tooltip">Fabricator: Produces high tier resources</div>
				<img src="./assets/buildings/fabricator.png" alt="Fabricator">
			</div>
		</div>

		<div id ="trade-hub-modal" class="building-modal modal">
			<div class="close-btn">x</div>
			<div class="modules-wrapper"></div>
			<div class="trade-menu-wrapper">
				<div class="trade-menu-header">
					<div class="my-trade-offers-title hoverable-tooltip">
						<div class="tooltip">Buyers can buy as long as you keep active & min. stock</div>
						My Trade Offers
					</div>
					<div class="separator"></div>
					<div class="world-trade-offers-title hoverable-tooltip">
						<div class="tooltip">More connected > more offers aggregated here</div>
						Swap
					</div>
				</div>
				<div class="my-trade-offer-lines-wrapper">
					<div class="my-trade-offer-line"> <!-- TEMPLATE -->
						<div class="resource offered">
							<div class="resource-icon energy"></div>
							<span class="resource-value" contenteditable="true">0</span>
						</div>
						<div class="arrow">-></div>
						<div class="resource requested">
							<div class="resource-icon chips"></div>
							<span class="resource-value" contenteditable="true">0</span>
						</div>
						<div class="min-stock hoverable-tooltip">
							<div class="tooltip">Minimum stock to keep</div>
							<span class="min-stock-value" contenteditable="true">0</span>
						</div>
						<div class="toggle-btn hoverable-tooltip">
							<div class="tooltip">Currently: Inactive</div>
						</div>
					</div>
				</div>
				<div class="separator"></div>
				<div class="swap-wrapper">
					<div class="resource sold hoverable-tooltip">
						<div class="tooltip">Chips</div>
						<div class="resource-icon chips"></div>
						<span class="resource-value" contenteditable="true">0</span>
					</div>
					<div class="arrow" id="reverse-resources-btn">‚Üë‚Üì</div>
					<div class="resource bought hoverable-tooltip">
						<div class="tooltip">Energy</div>
						<div class="resource-icon energy"></div>
						<span class="resource-value" contenteditable="true">0</span>
						<div class="taxRate">Tax: <span id="swap-tax-rate-value">30%</span></div>
					</div>
					<button class="swap-confirm-btn" disabled>
						<div class="loader"></div>
						<span>Confirm Swap</span>
					</button>
				</div>
			</div>
		</div>
		<div id ="reactor-modal" class="building-modal modal">
			<div class="close-btn">x</div>
			<div class="modules-wrapper"></div>
			<div class="production-lines-wrapper"></div>
		</div>
		<div id ="fabricator-modal" class="building-modal modal">
			<div class="close-btn">x</div>
			<div class="modules-wrapper"></div>
			<div class="production-lines-wrapper"></div>
		</div>

		<div id="connections-list-wrapper">
			<div class="close-btn" id="connections-list-close-btn">x</div>
			<div class="connections-list-header">
				<div class="connection-item-name">Name</div>
				<div class="connection-item-id">Node ID</div>
				<div class="connection-item-status">Status</div>
				<div class="connection-item-action accept">Action</div>
				<div class="connection-item-view-card">Show</div>
			</div>
			<div class="connections-list-body" id="connections-list">
				<div class="connection-item"> <!-- TEMPLATE -->
					<div class="connection-item-name">PlayerName</div>
					<div class="connection-item-id">bd86d7d3a566ad5a</div>
					<div class="connection-item-status">Pending</div> <!-- or Connected -->
					<div class="connection-item-action accept">Accept</div>  <!-- or Remove -->
					<div class="connection-item-view-card">üëÅ</div>
				</div>
			</div>
		</div>
	</div>
	<canvas id="particles-canvas"></canvas>
</body>
</html>